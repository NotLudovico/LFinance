import requests
from utilities.common import ETF


def get_etf_list():
    url = "https://dng-api.invesco.com/cache/v1/accounts/it_IT/shareclasses"
    params = {
        "idType": "isin",
        "accountType": "ETF",
        "variationType": "productsListing",
        "audienceType": "Individual Investor",
    }

    # Use a Python list, let requests JSON-encode it, and set proper headers.
    isins = [
        "IE00BFZPF322",
        "IE00BG0TQB18",
        "IE00BFZPF439",
        "IE000LGWDNE5",
        "IE000CYTPBT0",
        "IE00BD6FTQ80",
        "IE00BF4J0300",
        "IE000AYJ75E5",
        "IE000O36LOH8",
        "IE000XOS4OJ6",
        "IE000BMDG046",
        "IE000LKGEZQ6",
        "IE000A0RC215",
        "IE000ZC4C5Q1",
        "IE000C5Q64P6",
        "IE000W6YTDH7",
        "IE000GB2EQ90",
        "IE000AWRDWI7",
        "IE00BGBN6P67",
        "IE00BG7PP820",
        "IE00B449XP68",
        "IE00B435BG20",
        "IE00072RHT03",
        "IE000BRM9046",
        "IE00BFZXGZ54",
        "IE0032077012",
        "IE00BYVTMS52",
        "IE000Y2JPPS4",
        "IE000U7LIXH5",
        "IE00021E4FE3",
        "IE0006LBEDV2",
        "IE000PA766T7",
        "IE000MUAJIF4",
        "IE0008SEV3B2",
        "IE00BF51K249",
        "IE00B60SWX25",
        "IE00B5B5TG76",
        "IE00BZ4BMM98",
        "IE00BF51K132",
        "IE00B435CG94",
        "IE00B3BPCH51",
        "IE00BKWD3B81",
        "IE00BKWD3966",
        "IE00BGJWWY63",
        "IE00BGJWWV33",
        "IE00BGJWWT11",
        "IE00BGJWWW40",
        "IE00BGJWWX56",
        "IE000716YHJ7",
        "IE0006VDD4K1",
        "IE00BYYXBF44",
        "IE00B23LNQ02",
        "IE00B23D9570",
        "IE00B23D8X81",
        "IE00B23D8S39",
        "IE00B42Q4896",
        "IE000N42HDP2",
        "IE000XIBT2R7",
        "IE00BJQRDN15",
        "IE00BJQRDP39",
        "IE0008YN55P8",
        "IE00BLSNMW37",
        "IE00BLRB0242",
        "IE000FVQW7E7",
        "IE000ZWSN3F7",
        "IE000XG0ZRI7",
        "IE00B3WMTH43",
        "IE00053WDH64",
        "IE00B3YC1100",
        "IE00BPRCH686",
        "IE00BK80XL30",
        "IE00BM8QS095",
        "IE000PJL7R74",
        "IE00B3DWVS88",
        "IE00BG0NY640",
        "IE000TI21P14",
        "IE000LUZJNI7",
        "IE00B60SWY32",
        "IE00BJQRDL90",
        "IE000I8IKC59",
        "IE00B60SX287",
        "IE000RLUE8E9",
        "IE00B60SX170",
        "IE00BK5LYT47",
        "IE000CH3OQ51",
        "IE00BJQRDM08",
        "IE000V93BNU0",
        "IE00B60SX394",
        "IE00BJQRDK83",
        "IE00B3XM3R14",
        "IE00B94ZB998",
        "IE00B8CJW150",
        "IE00BQ70R696",
        "IE00BMD8KP97",
        "IE000COQKPO9",
        "IE000L2SA8K5",
        "IE00B579F325",
        "XS2183935274",
        "IE00BDVJF675",
        "IE00BDT8V027",
        "IE00BYM8JD58",
        "IE00B60SX402",
        "IE000N1ZEIG9",
        "IE0000TZZ2B2",
        "IE00BNGJJT35",
        "IE00BWTN6Y99",
        "IE00BKW9SX35",
        "IE00BDZCKK11",
        "IE00BKS7L097",
        "IE00B3YCGJ38",
        "IE00BYML9W36",
        "IE00BRKWGL70",
        "IE000K9Z3SF5",
        "IE0000FCGYF9",
        "IE000AIFGRB9",
        "IE00018LB0D8",
        "IE000L4EH2K5",
        "IE000Q0IU5T1",
        "IE00B5MTWD60",
        "IE00B60SWW18",
        "IE00BM8QRZ79",
        "IE00B3VSSL01",
        "IE00BD0Q9673",
        "IE00BYVTMZ20",
        "IE00BNG70R26",
        "IE00BKWD3C98",
        "IE00BF2FNG46",
        "IE00BKWD3743",
        "IE000FXHG8D6",
        "IE00BF2FNQ44",
        "IE00BF2FN646",
        "IE00BF2FN869",
        "IE00BF2GFH28",
        "IE0008GO35B5",
        "IE000PKN5N58",
        "IE00BF51K025",
        "IE00B3VPKB53",
        "IE00BG21M733",
        "IE0008RX29L5",
    ]
    headers = {
        "Accept": "application/json",
        "User-Agent": "Mozilla/5.0",
    }

    with requests.Session() as s:
        r = s.post(url, params=params, json=isins, headers=headers, timeout=30)
        r.raise_for_status()  # surface HTTP errors clearly
        data = r.json()  # donâ€™t re-parse text manually

    etfs = []
    for etf in data:
        etfs.append(
            ETF(
                isin=etf.get("isin"),
                ticker=etf.get("ticker"),
                name=etf.get("fundName"),
                issuer="invesco",
                ter=etf.get("terocf"),
                size=etf.get("aum"),
                nav=etf.get("nav"),
            )
        )
    return etfs


if __name__ == "__main__":
    print(get_etf_list())
